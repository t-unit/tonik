name: tonik_workspace

workspace:
 - packages/tonik
 - packages/tonik_core
 - packages/tonik_generate
 - packages/tonik_parse
 - packages/tonik_util

environment:
  sdk: '>=3.10.0 <4.0.0'

dependencies:
  collection: ^1.19.1
  dart_style: ^3.1.3
  logging: ^1.3.0
  meta: ^1.17.0
  path: ^1.9.1

dev_dependencies:
  coverage: ^1.10.0
  melos: ^7.3.0
  test: ^1.28.0
  timezone: ^0.11.0
  very_good_analysis: ^10.0.0

melos:
  scripts:
    test:
      run: dart test
      exec:
        concurrency: 1

    test:coverage:
      run: dart test --coverage=coverage
      exec:
        concurrency: 1
        
    generate:
      run: flutter pub run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 1
      select-package:
        depends-on: build_runner

    generate-integration-tests:
      run: ./scripts/setup_integration_tests.sh

    test-integration-petstore:
      run: |
        cd integration_test/petstore/petstore_test
        dart pub get
        dart test --concurrency=1

    test-integration-music-streaming:
      run: |
        cd integration_test/music_streaming/music_streaming_test
        dart pub get
        dart test --concurrency=1

    test-integration-gov:
      run: |
        cd integration_test/gov/gov_test
        dart pub get
        dart test --concurrency=1

    test-integration-simple-encoding:
      run: |
        cd integration_test/simple_encoding/simple_encoding_test
        dart pub get
        dart test --concurrency=1

    test-integration-fastify-type-provider-zod:
      run: |
        cd integration_test/fastify_type_provider_zod/fastify_type_provider_zod_test
        dart pub get
        dart test --concurrency=1

    test-integration-composition:
      run: |
        cd integration_test/composition/composition_test
        dart pub get
        dart test

    test-integration-query-parameters:
      run: |
        cd integration_test/query_parameters/query_parameters_test
        dart pub get
        dart test

    test-integration-path-encoding:
      run: |
        cd integration_test/path_encoding/path_encoding_test
        dart pub get
        dart test

    test-integration-binary-models:
      run: |
        cd integration_test/binary_models/binary_models_test
        dart pub get
        dart test --concurrency=1

    test-integration-form-urlencoded:
      run: |
        cd integration_test/form_urlencoded/form_urlencoded_test
        dart pub get
        dart test --concurrency=1

    test-integration-boolean-schemas:
      run: |
        cd integration_test/boolean_schemas/boolean_schemas_test
        dart pub get
        dart test --concurrency=1

    test-integration-type-arrays:
      run: |
        cd integration_test/type_arrays/type_arrays_test
        dart pub get
        dart test --concurrency=1

    test-integration-medama:
      run: |
        cd integration_test/medama/medama_test
        dart pub get
        dart test --concurrency=1

    test-integration-inference:
      run: |
        cd integration_test/inference/inference_test
        dart pub get
        dart test --concurrency=1

    test-integration-ref-siblings:
      run: |
        cd integration_test/ref_siblings/ref_siblings_test
        dart pub get
        dart test --concurrency=1

    test-integration-defs:
      run: |
        cd integration_test/defs/defs_test
        dart pub get
        dart test --concurrency=1

    test-integration-server-variables:
      run: |
        cd integration_test/server_variables/server_variables_test
        dart pub get
        dart test --concurrency=1

    test-integration-cookies:
      run: |
        cd integration_test/cookies/cookies_test
        dart pub get
        dart test --concurrency=1

    test-integration-all:
      run: |
        melos run test-integration-petstore
        melos run test-integration-music-streaming
        melos run test-integration-gov
        melos run test-integration-simple-encoding
        melos run test-integration-fastify-type-provider-zod
        melos run test-integration-composition
        melos run test-integration-query-parameters
        melos run test-integration-path-encoding
        melos run test-integration-binary-models
        melos run test-integration-form-urlencoded
        melos run test-integration-boolean-schemas
        melos run test-integration-type-arrays
        melos run test-integration-medama
        melos run test-integration-inference
        melos run test-integration-ref-siblings        
        melos run test-integration-defs
        melos run test-integration-server-variables
        melos run test-integration-cookies